<div class="overflow-hidden dark-edition bg-white">
    <div class="wrapper">
        <app-side-bar></app-side-bar>
        <div class="main-panel">
            <app-nav-bar></app-nav-bar>

            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 col-sm-12 mb-30">
                            <div class="card card-statistics h-100">
                                <div class="card-body">
                                    <div class="x_panel">
                                        <div class="x_title">
                                            <h2>Exams Information</h2>
                                            <ul class="nav navbar-right panel_toolbox">
                                                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                                </li>
                                            </ul>
                                            <div class="clearfix"></div>
                                        </div>
                                        <div class="x_content">
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <div class="card-box table-responsive">
                                                        <p class="text-muted font-13 m-b-30">
                                                            <button class="btn btn-success btn-lg"
                                                                (click)="openCreateExamDialog()" aria-pressed="true">Add
                                                                Exam</button>
                                                            <br><br>
                                                        </p>

                                                        <table mat-table [dataSource]="dataSource" multiTemplateDataRows
                                                            class="mat-elevation-z8">
                                                            <ng-container matColumnDef="{{column}}"
                                                                *ngFor="let column of columnsToDisplay">

                                                                <th mat-header-cell *matHeaderCellDef>

                                                                    <span *ngIf="column == 'courseName'">
                                                                        Course Name
                                                                    </span>

                                                                    <span *ngIf="column == 'title'">
                                                                        Exam Name
                                                                    </span>

                                                                    <span *ngIf="column == 'successMark'">
                                                                        Success Mark
                                                                    </span>

                                                                    <span *ngIf="column == 'startDate'">
                                                                        Start Date
                                                                    </span>

                                                                    <span *ngIf="column == 'endDate'">
                                                                        End Date
                                                                    </span>

                                                                    <span *ngIf="column == 'examLevel'">
                                                                        Exam Level
                                                                    </span>

                                                                    <span *ngIf="column == 'cost'">
                                                                        Cost
                                                                    </span>
                                                                </th>

                                                                <ng-container mat-cell *matCellDef="let element">
                                                                    <td *ngIf="column == 'courseName'">
                                                                        {{ element[column] | titlecase }}</td>

                                                                    <td *ngIf="column == 'title'">
                                                                        {{ element[column] | titlecase }}</td>

                                                                    <td *ngIf="column == 'startDate'">
                                                                        {{ element[column] | date: 'medium' }}</td>

                                                                    <td *ngIf="column == 'endDate'">
                                                                        {{ element[column] | date: 'medium' }}</td>

                                                                    <td *ngIf="column == 'successMark'">
                                                                        {{ element[column] }}%</td>

                                                                    <td *ngIf="column == 'cost'">
                                                                        {{ element[column] }}$</td>
                                                                    <td *ngIf="column == 'examLevel'">
                                                                        {{ element[column] }}</td>
                                                                </ng-container>
                                                            </ng-container>
                                                            <ng-container matColumnDef="expand">
                                                                <th mat-header-cell *matHeaderCellDef
                                                                    aria-label="row actions">&nbsp;</th>
                                                                <td mat-cell *matCellDef="let element">
                                                                    <button mat-icon-button aria-label="expand row"
                                                                        (click)="(expandedElement = expandedElement === element ? null : element); $event.stopPropagation()">
                                                                        <mat-icon *ngIf="expandedElement !== element">
                                                                            keyboard_arrow_down</mat-icon>
                                                                        <mat-icon *ngIf="expandedElement === element">
                                                                            keyboard_arrow_up</mat-icon>
                                                                    </button>
                                                                </td>
                                                            </ng-container>

                                                            <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
                                                            <ng-container matColumnDef="expandedDetail">
                                                                <td mat-cell *matCellDef="let element"
                                                                    [attr.colspan]="columnsToDisplayWithExpand.length">
                                                                    <div class="example-element-detail"
                                                                        [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">

                                                                        <div
                                                                            class="row justify-content-around w-100 mt-4 mb-5">

                                                                            <!-- Exam Description Section -->
                                                                            <div class="col-4">

                                                                                <!-- Exam Description -->
                                                                                <div class="container" style="border-radius: 5px;
                                                                                border: 1px solid silver;">
                                                                                    <!-- Description Label -->
                                                                                    <div
                                                                                        class="row justify-content-start ml-3 description-label">
                                                                                        Description
                                                                                    </div>
                                                                                    <hr class="mb-0"
                                                                                        style="color: silver" />
                                                                                    <!-- Description Textarea -->
                                                                                    <div
                                                                                        class="row justify-content-start ml-3 p-3 description-container">
                                                                                        <p title="Exam Description">
                                                                                            {{ element.description }}
                                                                                        </p>
                                                                                    </div>

                                                                                </div>

                                                                                <!-- Creation Date -->
                                                                                <div class="mt-3">

                                                                                    <div class="container cus-border">

                                                                                        <div class="row">
                                                                                            <!-- Creation Date Label -->
                                                                                            <div
                                                                                                class="col-5 p-3 font-family-tahoma cus-st">
                                                                                                Creation Date
                                                                                            </div>

                                                                                            <!-- Creation Date Data -->
                                                                                            <div title="Exam Creation Date"
                                                                                                class="col-7 p-3 font-family-tahoma">
                                                                                                {{ element.creationDate
                                                                                                | date:
                                                                                                'medium' }}
                                                                                            </div>
                                                                                        </div>


                                                                                    </div>

                                                                                </div>
                                                                            </div>

                                                                            <!-- Exam Image, Title And Buttons -->
                                                                            <div class="col-4">

                                                                                <!-- Exam Image -->
                                                                                <div class="row">
                                                                                    <div class="container">
                                                                                        <div class="exam-img"
                                                                                            title="Exam Image"
                                                                                            style="background-image: url('../../../assets/images/exam_images/{{ element.examImage }}')">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>

                                                                                <!-- Exam Title -->
                                                                                <div class="row justify-content-center">
                                                                                    <h3 class="texe-center ex-title"
                                                                                        title="Exam Title">
                                                                                        {{ element.title | titlecase }}
                                                                                    </h3>
                                                                                </div>

                                                                                <!-- Exam Proccess -->
                                                                                <div class="row justify-content-center">
                                                                                    <div class="container w-50">
                                                                                        <div
                                                                                            class="row justify-content-between">

                                                                                            <a class="btn btn-info btn-sm"
                                                                                                role="button"
                                                                                                aria-pressed="true"
                                                                                                title="Edit"
                                                                                                (click)="updateExam(element)"><i
                                                                                                    class="fa fa-edit"></i></a>
                                                                                            <a class="btn btn-danger btn-sm text-white"
                                                                                                role="button"
                                                                                                aria-pressed="true"
                                                                                                title="Delete"
                                                                                                (click)="deleteExam(element)"
                                                                                                style="cursor:pointer;"><i
                                                                                                    class="fa fa-trash"></i></a>

                                                                                            <a class="btn btn-success btn-sm text-white"
                                                                                                role="button"
                                                                                                aria-pressed="true"
                                                                                                title="Add Questions"
                                                                                                style="cursor:pointer;"><i
                                                                                                    class="fa fa-plus"></i></a>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            <!-- Exam Details -->
                                                                            <div class="col-4">

                                                                                <div class="row">
                                                                                    <div class="container">

                                                                                        <!-- Passcode -->
                                                                                        <div class="row cus-border">
                                                                                            <div
                                                                                                class="col-6 py-3 cus-st">
                                                                                                Passcode
                                                                                            </div>

                                                                                            <div class="col-4 py-3"
                                                                                                title="Exam Passcode">
                                                                                                {{ element.passcode }}
                                                                                            </div>
                                                                                        </div>

                                                                                        <!-- Mark Status -->
                                                                                        <div
                                                                                            class="row mt-3 cus-border">
                                                                                            <div
                                                                                                class="col-6 py-3 cus-st">
                                                                                                Mark Status
                                                                                            </div>

                                                                                            <div class="col-4 py-3"
                                                                                                title="Exam Mark Status">
                                                                                                {{ element.markStatus }}
                                                                                            </div>
                                                                                        </div>

                                                                                        <!-- Status -->
                                                                                        <div
                                                                                            class="row mt-3 cus-border">
                                                                                            <div
                                                                                                class="col-6 py-3 cus-st">
                                                                                                Status
                                                                                            </div>

                                                                                            <div class="col-4 py-3"
                                                                                                title="Exam Status">
                                                                                                {{ element.status }}
                                                                                            </div>
                                                                                        </div>

                                                                                        <!-- Number Of Questions -->
                                                                                        <div
                                                                                            class="row mt-3 cus-border">
                                                                                            <div
                                                                                                class="col-6 py-3 cus-st">
                                                                                                Number Of Questions
                                                                                            </div>

                                                                                            <div class="col-4 py-3"
                                                                                                title="Exam Number Of Questions">
                                                                                                {{
                                                                                                element.numberOfQuestions
                                                                                                }}
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>

                                                                                </div>

                                                                            </div>

                                                                        </div>

                                                                    </div>
                                                                </td>
                                                            </ng-container>

                                                            <tr mat-header-row
                                                                *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
                                                            <tr mat-row
                                                                *matRowDef="let element; columns: columnsToDisplayWithExpand;"
                                                                class="example-element-row"
                                                                [class.example-expanded-row]="expandedElement === element"
                                                                (click)="expandedElement = expandedElement === element ? null : element">
                                                            </tr>
                                                            <tr mat-row
                                                                *matRowDef="let row; columns: ['expandedDetail']"
                                                                class="example-detail-row"></tr>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>

        </div>
    </div>
</div>


<!-- Update Exam Dialog -->
<ng-template #callUpdateDialog>
    <mat-dialog-content class="col-12 m-0 mat-typography" style="width: 600px;">
        <div class="modal-header mb-3">
            <h5 style="font-family: 'Cairo', sans-serif; font-weight: bold; color: black;" class="modal-title"
                id="exampleModalLabel">Update Exam</h5>
            <button type="button" class="close text-danger" mat-button mat-dialog-close="no">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <form class="example-form" [formGroup]="updateForm">

            <div class="row py-1  mt-2">
                <div class="col-md-12">
                    <mat-form-field class="example-full-width w-100" appearance="fill">
                        <mat-label>Course Name </mat-label>
                        <mat-select formControlName="courseId" [(ngModel)]="exam.courseId">
                            <mat-option *ngFor="let course of adminService.CoursesData" value="{{ course.id }}">
                                {{
                                course.courseName | titlecase }}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>

            <div class="row py-1">
                <div class="col-md-12">
                    <mat-form-field class="w-100 example-full-width" appearance="fill">
                        <mat-label>Exam Name</mat-label>
                        <input type="text" matInput formControlName="title" [(ngModel)]="exam.title">
                        <mat-error *ngIf="updateForm.controls.title.hasError('maxlength')">
                            Max Length<strong> 50</strong>
                        </mat-error>
                        <mat-error *ngIf="updateForm.controls.title.hasError('required')">
                            This Filed is <strong>required</strong>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="row py-1 mt-2">
                <div class="col-md-12">
                    <mat-form-field class="example-full-width w-100" appearance="fill">
                        <mat-label>Description </mat-label>
                        <textarea style="height: 123px!important" type="text" matInput [(ngModel)]="exam.description"
                            formControlName="description"></textarea>
                        <mat-error *ngIf="updateForm.controls.description.hasError('maxlength')">
                            Max Length<strong> 150</strong>
                        </mat-error>

                        <mat-error *ngIf="updateForm.controls.description.hasError('required')">
                            This Filed is <strong>required</strong>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="row py-1  mt-2">
                <div class="col-md-12">
                    <mat-form-field class="example-full-width w-100" appearance="fill">
                        <mat-label>Exam Level </mat-label>
                        <mat-select formControlName="examLevel" [(ngModel)]="exam.examLevel">
                            <mat-option value="Beginner">Beginner</mat-option>
                            <mat-option value="Intermediate">Intermediate</mat-option>
                            <mat-option value="Advanced">Advanced</mat-option>
                            <mat-option value="Expert">Expert</mat-option>
                        </mat-select>

                        <mat-error *ngIf="updateForm.controls.examLevel.hasError('required')">
                            This Filed is <strong>required</strong>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="row py-1 mt-2">
                <div class="col-md-6 mt-2 mt-sm-2 mt-md-0">
                    <mat-form-field class="example-full-width w-100" appearance="fill">
                        <mat-label>Start Date</mat-label>
                        <input type="datetime-local" matInput formControlName="startDate" [(ngModel)]="exam.startDate">
                        <mat-error *ngIf="updateForm.controls.startDate.hasError('required')">
                            This Filed is <strong>required</strong>
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="col-md-6 mt-2 mt-sm-2 mt-md-0">
                    <mat-form-field class="example-full-width w-100" appearance="fill">
                        <mat-label>End Date</mat-label>
                        <input type="datetime-local" matInput formControlName="endDate" [(ngModel)]="exam.endDate">

                        <mat-error *ngIf="updateForm.controls.endDate.hasError('required')">
                            This Filed is <strong>required</strong>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="row py-1  mt-2">
                <div class="col-md-6 mt-2 mt-sm-2 mt-md-0">
                    <mat-form-field class="example-full-width w-100" appearance="fill">
                        <mat-label>Mark Status</mat-label>
                        <mat-select formControlName="markStatus" [(ngModel)]="exam.markStatus">
                            <mat-option value="HIDE">HIDE</mat-option>
                            <mat-option value="SHOW">SHOW</mat-option>
                        </mat-select>
                        <mat-error *ngIf="updateForm.controls.markStatus.hasError('required')">
                            This Filed is <strong>required</strong>
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="col-md-6 mt-2 mt-sm-2 mt-md-0">
                    <mat-form-field class="example-full-width w-100" appearance="fill">
                        <mat-label>Status</mat-label>
                        <mat-select formControlName="status" [(ngModel)]="exam.status">
                            <mat-option value="ENABLE">ENABLE</mat-option>
                            <mat-option value="DISABLE">DISABLE</mat-option>
                        </mat-select>
                        <mat-error *ngIf="updateForm.controls.status.hasError('required')">
                            This Filed is <strong>required</strong>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="row py-1 mt-2">
                <div class="col-md-4">
                    <mat-form-field class="example-full-width w-100" appearance="fill">
                        <mat-label>Success Mark %</mat-label>
                        <input type="number" step="10" matInput formControlName="successMark"
                            [(ngModel)]="exam.successMark" />
                        <mat-error *ngIf=" updateForm.controls.successMark.hasError('max')">
                            Max Value<strong> 100</strong>
                        </mat-error>

                        <mat-error *ngIf="updateForm.controls.successMark.hasError('min')">
                            Min Value<strong> 0</strong>
                        </mat-error>

                        <mat-error *ngIf="updateForm.controls.successMark.hasError('required')">
                            This Filed is <strong>required</strong>
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="col-md-4 mt-2 mt-sm-2 mt-md-0">
                    <mat-form-field class="example-full-width w-100" appearance="fill">
                        <mat-label>Number Of Questions</mat-label>
                        <input type="number" step="10" matInput formControlName="numberOfQuestions"
                            [(ngModel)]="exam.numberOfQuestions" />
                        <mat-error *ngIf="updateForm.controls.numberOfQuestions.hasError('min')">
                            Min Value<strong> 1</strong>
                        </mat-error>

                        <mat-error *ngIf="updateForm.controls.numberOfQuestions.hasError('required')">
                            This Filed is <strong>required</strong>
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="col-md-4 mt-2 mt-sm-2 mt-md-0">
                    <mat-form-field class="example-full-width w-100" appearance="fill">
                        <mat-label>Cost $</mat-label>
                        <input type="number" step="10" matInput formControlName="cost" [(ngModel)]="exam.cost" />
                        <mat-error *ngIf="updateForm.controls.cost.hasError('min')">
                            Min Value<strong> 0</strong>
                        </mat-error>

                        <mat-error *ngIf="updateForm.controls.cost.hasError('required')">
                            This Filed is <strong>required</strong>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="row py-1 mt-2">
                <div class="col-12">
                    <mat-form-field class="example-full-width w-100" appearance="fill">
                        <mat-label>Zoom Link</mat-label>
                        <input type="text" matInput formControlName="zoomMeeting" [(ngModel)]="exam.zoomMeeting" />
                    </mat-form-field>

                </div>
            </div>

            <div class="row py-1 mt-2">
                <div class="col-md-6">
                    <label class="form-check-label mb-2" for="examImg" style="color: #6c757d;">Exam Image</label>
                    <input type="file" #file id="examImg" formControlName="examImage" [(ngModel)]="exam.examImage" />
                </div>
            </div>

        </form>

        <mat-dialog-actions>
            <button class="btn btn-sm btn-danger" mat-button mat-dialog-close>Cancel</button>
            <button class="btn btn-sm btn-success" mat-button [mat-dialog-close]="true" [disabled]="!updateForm.valid"
                (click)="saveExam()">Save</button>
        </mat-dialog-actions>

    </mat-dialog-content>
</ng-template>
<!-- /End Update Exam Dialog -->

<!-- Delete Exam Dialog -->
<ng-template #callDeleteDialog>
    <div class="modal-header">
        <h5 style="font-family: 'Cairo', sans-serif; font-weight: bold; color: black;" class="modal-title"
            id="exampleModalLabel">Deleted Exam</h5>
        <button type="button" class="close text-danger" mat-button mat-dialog-close="no">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body py-3">
        <h5 style="font-family: 'Cairo', sans-serif; color: black; font-weight: bold;">Are you sure you want to delete
            exam and all related data?
        </h5>
        <label style="color: #001166; font-weight:bold;">Exam Name: {{exam.title}}</label>

    </div>
    <div class="modal-footer">
        <button class="btn btn-sm btn-secondary font-weight-bold" at-button mat-dialog-close="no">Close</button>
        <button class="btn btn-sm btn-danger" mat-button mat-dialog-close="yes"
            (click)="submitDeleteExam(exam.id)">Delete</button>
    </div>
</ng-template>
<!-- /End Delete Exam Dialog -->